<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Smart Invoice Processor</title>
        <!-- Favicon -->
        <!-- Favicon - Emoji version -->
        <link rel="icon"
            href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' font-size='90'%3EüìÑ%3C/text%3E%3C/svg%3E">
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
        .file-upload-area {
            border: 2px dashed #cbd5e0;
            transition: all 0.3s;
        }
        .file-upload-area:hover {
            border-color: #4299e1;
            background-color: #ebf8ff;
        }
        .file-upload-area.drag-over {
            border-color: #3182ce;
            background-color: #bee3f8;
        }
    </style>
    </head>
    <body class="bg-gray-50">
        <div id="root"></div>

        <script crossorigin
            src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
        <script crossorigin
            src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
        <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

        <script type="text/babel">
        const { useState } = React;

        function App() {
            const [file, setFile] = useState(null);
            const [loading, setLoading] = useState(false);
            const [result, setResult] = useState(null);
            const [error, setError] = useState(null);
            const [dragOver, setDragOver] = useState(false);

            // Update this with your backend URL
           //const API_URL = 'http://localhost:8000';
           const API_URL = 'https://receipt-processor-production-7bda.up.railway.app';
          

            const handleFileChange = (e) => {
                const selectedFile = e.target.files[0];
                if (selectedFile) {
                    setFile(selectedFile);
                    setError(null);
                    setResult(null);
                }
            };

            const handleDrop = (e) => {
                e.preventDefault();
                setDragOver(false);
                const droppedFile = e.dataTransfer.files[0];
                if (droppedFile) {
                    setFile(droppedFile);
                    setError(null);
                    setResult(null);
                }
            };

            const handleDragOver = (e) => {
                e.preventDefault();
                setDragOver(true);
            };

            const handleDragLeave = () => {
                setDragOver(false);
            };

            const processInvoice = async () => {
                if (!file) {
                    setError('Please select a file first');
                    return;
                }

                setLoading(true);
                setError(null);

                const formData = new FormData();
                formData.append('file', file);

                try {
                    const response = await fetch(`${API_URL}/process-invoice`, {
                        method: 'POST',
                        body: formData,
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.detail || 'Failed to process invoice');
                    }

                    const data = await response.json();
                    setResult(data);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            const getConfidenceColor = (score) => {
                if (score >= 0.8) return 'text-green-600';
                if (score >= 0.6) return 'text-yellow-600';
                return 'text-red-600';
            };

            const getConfidenceBadge = (score) => {
                if (score >= 0.8) return 'bg-green-100 text-green-800';
                if (score >= 0.6) return 'bg-yellow-100 text-yellow-800';
                return 'bg-red-100 text-red-800';
            };

            return (
                <div className="min-h-screen py-8 px-4">
                    <div className="max-w-6xl mx-auto">
                        {/* Header */}
                        <div className="text-center mb-8">
                            <h1 className="text-4xl font-bold text-gray-900 mb-2">
                                üìÑ Smart Invoice Processor
                            </h1>
                            <p className="text-gray-600">
                                Upload an invoice or receipt to extract data automatically
                            </p>
                        </div>

                        {/* Upload Section */}
                        <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                            <div
                                className={`file-upload-area rounded-lg p-8 text-center ${
                                    dragOver ? 'drag-over' : ''
                                }`}
                                onDrop={handleDrop}
                                onDragOver={handleDragOver}
                                onDragLeave={handleDragLeave}
                            >
                                <input
                                    type="file"
                                    id="file-input"
                                    className="hidden"
                                    accept=".pdf,.jpg,.jpeg,.png,.webp"
                                    onChange={handleFileChange}
                                />
                                <label htmlFor="file-input" className="cursor-pointer">
                                    <div className="text-6xl mb-4">üìé</div>
                                    <p className="text-lg font-semibold text-gray-700 mb-2">
                                        Drop your invoice here or click to browse
                                    </p>
                                    <p className="text-sm text-gray-500">
                                        Supports PDF, JPG, PNG, WEBP
                                    </p>
                                </label>
                            </div>

                            {file && (
                                <div className="mt-4 p-4 bg-blue-50 rounded-lg flex items-center justify-between">
                                    <div className="flex items-center">
                                        <span className="text-2xl mr-3">üìÑ</span>
                                        <div>
                                            <p className="font-medium text-gray-900">{file.name}</p>
                                            <p className="text-sm text-gray-600">
                                                {(file.size / 1024 / 1024).toFixed(2)} MB
                                            </p>
                                        </div>
                                    </div>
                                    <button
                                        onClick={() => setFile(null)}
                                        className="text-red-600 hover:text-red-800"
                                    >
                                        ‚úï
                                    </button>
                                </div>
                            )}

                            <button
                                onClick={processInvoice}
                                disabled={!file || loading}
                                className={`w-full mt-6 py-3 px-6 rounded-lg font-semibold text-white transition-colors ${
                                    !file || loading
                                        ? 'bg-gray-400 cursor-not-allowed'
                                        : 'bg-blue-600 hover:bg-blue-700'
                                }`}
                            >
                                {loading ? 'Processing...' : 'Process Invoice'}
                            </button>
                        </div>

                        {/* Error Message */}
                        {error && (
                            <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
                                <div className="flex items-center">
                                    <span className="text-2xl mr-3">‚ö†Ô∏è</span>
                                    <p className="text-red-800">{error}</p>
                                </div>
                            </div>
                        )}

                        {/* Results */}
                        {result && (
                            <div className="space-y-6">
                                {/* Summary Card */}
                                <div className="bg-white rounded-lg shadow-md p-6">
                                    <h2 className="text-2xl font-bold text-gray-900 mb-4">
                                        Invoice Summary
                                    </h2>
                                    <div className="grid md:grid-cols-2 gap-4">
                                        <div>
                                            <p className="text-sm text-gray-600">Vendor</p>
                                            <p className="text-lg font-semibold text-gray-900">
                                                {result.vendor_name}
                                            </p>
                                            <span
                                                className={`text-xs px-2 py-1 rounded ${getConfidenceBadge(
                                                    result.confidence_scores.vendor_name
                                                )}`}
                                            >
                                                {(result.confidence_scores.vendor_name * 100).toFixed(0)}%
                                                confidence
                                            </span>
                                        </div>
                                        <div>
                                            <p className="text-sm text-gray-600">Date</p>
                                            <p className="text-lg font-semibold text-gray-900">
                                                {result.date}
                                            </p>
                                            <span
                                                className={`text-xs px-2 py-1 rounded ${getConfidenceBadge(
                                                    result.confidence_scores.date
                                                )}`}
                                            >
                                                {(result.confidence_scores.date * 100).toFixed(0)}%
                                                confidence
                                            </span>
                                        </div>
                                        <div>
                                            <p className="text-sm text-gray-600">Total Amount</p>
                                            <p className="text-2xl font-bold text-green-600">
                                                ${result.total_amount.toFixed(2)}
                                            </p>
                                            <span
                                                className={`text-xs px-2 py-1 rounded ${getConfidenceBadge(
                                                    result.confidence_scores.total_amount
                                                )}`}
                                            >
                                                {(result.confidence_scores.total_amount * 100).toFixed(0)}%
                                                confidence
                                            </span>
                                        </div>
                                        {result.tax_amount && (
                                            <div>
                                                <p className="text-sm text-gray-600">Tax Amount</p>
                                                <p className="text-lg font-semibold text-gray-900">
                                                    ${result.tax_amount.toFixed(2)}
                                                </p>
                                                <span
                                                    className={`text-xs px-2 py-1 rounded ${getConfidenceBadge(
                                                        result.confidence_scores.tax_amount
                                                    )}`}
                                                >
                                                    {(result.confidence_scores.tax_amount * 100).toFixed(0)}%
                                                    confidence
                                                </span>
                                            </div>
                                        )}
                                    </div>
                                </div>

                                {/* Line Items */}
                                <div className="bg-white rounded-lg shadow-md p-6">
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-2xl font-bold text-gray-900">Line Items</h2>
                                        <span
                                            className={`text-xs px-2 py-1 rounded ${getConfidenceBadge(
                                                result.confidence_scores.line_items
                                            )}`}
                                        >
                                            {(result.confidence_scores.line_items * 100).toFixed(0)}%
                                            confidence
                                        </span>
                                    </div>
                                    <div className="overflow-x-auto">
                                        <table className="w-full">
                                            <thead>
                                                <tr className="border-b border-gray-200">
                                                    <th className="text-left py-3 px-4 text-sm font-semibold text-gray-700">
                                                        Description
                                                    </th>
                                                    <th className="text-right py-3 px-4 text-sm font-semibold text-gray-700">
                                                        Qty
                                                    </th>
                                                    <th className="text-right py-3 px-4 text-sm font-semibold text-gray-700">
                                                        Unit Price
                                                    </th>
                                                    <th className="text-right py-3 px-4 text-sm font-semibold text-gray-700">
                                                        Amount
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {result.line_items.map((item, index) => (
                                                    <tr
                                                        key={index}
                                                        className="border-b border-gray-100 hover:bg-gray-50"
                                                    >
                                                        <td className="py-3 px-4 text-sm text-gray-900">
                                                            {item.description}
                                                        </td>
                                                        <td className="py-3 px-4 text-sm text-gray-700 text-right">
                                                            {item.quantity || '-'}
                                                        </td>
                                                        <td className="py-3 px-4 text-sm text-gray-700 text-right">
                                                            {item.unit_price
                                                                ? `$${item.unit_price.toFixed(2)}`
                                                                : '-'}
                                                        </td>
                                                        <td className="py-3 px-4 text-sm font-semibold text-gray-900 text-right">
                                                            ${item.amount.toFixed(2)}
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                {/* JSON Output */}
                                <div className="bg-white rounded-lg shadow-md p-6">
                                    <h2 className="text-2xl font-bold text-gray-900 mb-4">
                                        Raw JSON Output
                                    </h2>
                                    <pre className="bg-gray-900 text-green-400 p-4 rounded-lg overflow-x-auto text-sm">
                                        {JSON.stringify(result, null, 2)}
                                    </pre>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
    </body>
</html>
